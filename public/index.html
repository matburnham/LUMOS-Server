<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>LUMOS - Command &amp; Control</title>

  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap theme -->
  <link href="css/bootstrap-theme.min.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
      <style type="text/css">
        iframe[seamless]{
          background-color: transparent;
          border: 0px none transparent;
          padding: 0px;
          overflow: hidden;
        }

        .btn-pad {
          padding-top: 15px;
        }

        .content{
          display:none;
        }

        .content.active{
          display:block;
        }

        a.disabled {
          pointer-events: none;
        }

        .btnNode {
          padding: 7px !important;
        }

        .btnNodeDrop {
          padding-top: 7px !important;
          padding-bottom: 7px !important;
          padding-left: 9px !important;
          padding-right: 9px !important;
        }

        .col-lg-1, .col-lg-10, .col-lg-11, .col-lg-12, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-md-1, .col-md-10, .col-md-11, .col-md-12, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-sm-1, .col-sm-10, .col-sm-11, .col-sm-12, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-xs-1, .col-xs-10, .col-xs-11, .col-xs-12, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9 {
          padding-right: 5px;
          padding-left: 5px;
        }

        .text-muted {
          color: #CCC;
        }
      </style>
    </head>
    <body>
      <br/>
      <ul class="nav nav-tabs">
        <li role="presentation">&nbsp;&nbsp;</li>
        <li role="presentation" rel="overview" class="active"><a href="#">Overview</a></li>
        <li role="presentation" rel="server_settings"><a href="#">Server Settings</a></li>
      </ul>

      <!-- Overview Panel -->
      <div class="content active" id="overview">
        <div class="container-fluid">
          <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
            <!-- Node Panels -->
            <div id="nodeButtons">
            </div>
          </div>
          <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" style="height: 100%">
            <iframe src="about:blank" name="nodeframe" seamless="seamless" width="100%" style="height: calc(100vh - 70px)"></iframe>
          </div>
        </div>
      </div>

      <!-- Server Settings Panel -->
      <div class="content" id="server_settings">
        <div class="container">
          <div class="col-sm-12">
            &nbsp;
          </div>
        </div>
      </div>

      <!-- Node Info Modals -->
      <div id="nodeModals">
      </div>

      <!-- Confirm shutdown Modal -->
      <div class="modal fade" tabindex="-1" role="dialog" id="shutdownModal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title">Shutdown Node</h4>
            </div>
            <div class="modal-body">
              <p>&nbsp;</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              <a class="btn btn-danger" id="modalShutdownBTN" href="#" target="nodeframe" onclick="$('#shutdownModal').modal('hide');">Shutdown</a>
            </div>
          </div>
        </div>
      </div>

      <script id="nodeButtonTemplate" type="x-handlebars-template">
        <div class="col-xs-4 col-sm-2 col-md-2 col-lg-2 text-center nodeButton" id="nodeButton{{ nodeID }}">
          <div class="btn-group btn-pad">
            <button type="button" class="btn btn-danger btnNode" id="nodeButtonMain{{ nodeID }}" data-toggle="modal" data-target="#nodeDetailModal{{ nodeID }}" data-nodeid="{{ nodeID }}"><span class="glyphicon glyphicon-stop" id="nodeButtonIcon{{ nodeID }}" aria-hidden="true" style="font-size: 13px; color: #{{ colour }};"></span> {{ nodeID }}<!-- - {{ name }}--></button>
            <button type="button" class="btn btn-danger dropdown-toggle btnNodeDrop" id="nodeButtonDropdown{{ nodeID }}"data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
            <li class="disabled"><a class="disabled" href="http://admin:esp8266@{{ ip }}/" id="nodeButtonConfigLink{{ nodeID }}" target="nodeframe"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> View Config Page</a></li>
            <li class="disabled"><a class="disabled" href="http://admin:esp8266@{{ ip }}/findme" id="nodeButtonFindMeLink{{ nodeID }}" target="nodeframe"><span class="glyphicon glyphicon-flag" aria-hidden="true"></span> Find Me</a></li>
            <li id="nodeButtonEnabled{{ nodeID }}"><a href="#"><span class="glyphicon {{#if enabled}}glyphicon-remove{{else}}glyphicon-ok{{/if}}" aria-hidden="true"></span> {{#if enabled}}Disable{{else}}Enable{{/if}}</a></li>
            <li role="separator" class="divider"></li>
            <li class="disabled" data-toggle="modal" data-target="" data-name="{{ name }}" data-nodeid="{{ nodeID }}"><a class="disabled" href="#" id="nodeButtonShutdownLink{{ nodeID }}"><span class="glyphicon glyphicon-off" aria-hidden="true"></span> Shutdown</a></li>
          </ul>
        </div>
      </div>
    </script>

    <script id="nodeDetailModalTemplate" type="x-handlebars-template">
      <div class="modal fade nodeDetailModal" id="nodeDetailModal{{ nodeID }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">{{ nodeID }} - {{ name }}</h4>
            </div>
            <div class="modal-body">
              <div class="container-fluid">
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Status</h3>
                    </div>
                    <div class="panel-body" id="nodeDetailModalStatus{{ nodeID }}">
                      {{#if online}}Online{{else}}Offline{{/if}} - {{#if enabled}}Enabled{{else}}Disabled{{/if}}
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Colour</h3>
                    </div>
                    <div class="panel-body" id="nodeDetailModalColour{{ nodeID }}">
                      #{{ colour }}
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">IP Address</h3>
                    </div>
                    <div class="panel-body">
                      <a target="_blank" class="text-muted" id="nodeDetailModalStatusIP{{ nodeID }}" href="http://{{ ip }}">
                        {{ ip }}&nbsp;
                      </a>
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Mac Address</h3>
                    </div>
                    <div class="panel-body text-muted" id="nodeDetailModalStatusMac{{ nodeID }}">
                      {{ mac }}&nbsp;
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Current Voltage</h3>
                    </div>
                    <div class="panel-body text-muted" id="nodeDetailModalStatusCurrentVoltage{{ nodeID }}">
                      {{ current_voltage }}&nbsp;
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Lowest Voltage</h3>
                    </div>
                    <div class="panel-body text-muted" id="nodeDetailModalStatusLowestVoltage{{ nodeID }}">
                      {{ lowest_voltage }}&nbsp;
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Hardware Ver'</h3>
                    </div>
                    <div class="panel-body text-muted" id="nodeDetailModalStatusHardwareVersion{{ nodeID }}">
                      {{ hw_version }}&nbsp;
                    </div>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Software Ver'</h3>
                    </div>
                    <div class="panel-body text-muted" id="nodeDetailModalStatusSoftwareVersion{{ nodeID }}">
                      {{ sw_version }}&nbsp;
                    </div>
                  </div>
                </div>
                <div class="col-sm-12">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h3 class="panel-title">Voltage Graph</h3>
                    </div>
                    <div class="panel-body" style="padding-bottom:0px" id="nodeDetailModalStatusVoltageChartPanel{{ nodeID }}">
                      <canvas id="nodeDetailModalStatusVoltageChart{{ nodeID }}"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/handlebars.min.js"></script>
    <script type="text/javascript">
      $(function(){
        //Diry tab selection code, FIXME
        $('.nav-tabs li').on('click', function(){
          $('.nav-tabs li.active').removeClass('active');
          $(this).addClass('active');
          
          var contentToShow = $(this).attr('rel');
          $('.content.active').hide().removeClass('active');
          $('#'+contentToShow).show().addClass('active');
        });
      });

      function setURL(url){
        document.getElementById('nodeframe').src = url;
      }
    </script>

    <script src="/js/Chart.bundle.js"></script>
    <script src="/js/mobile-detect.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <!-- <script src="/jquery-1.11.1.js"></script> -->
    <script type="text/javascript">
      var socket = io();

      window.charts = [];
      var chartData = [];
      chartData.current_voltage_data = [];
      chartData.lowest_voltage_data = [];

      $('#shutdownModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var name = button.data('name'); // Extract info from data-* attributes
        var id = button.data('nodeid'); // Extract info from data-* attributes
        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this);
        modal.find('.modal-body').html("Are you sure you want to shutdown: " + name + "<br/>A manual restart will be required.");
        $('#modalShutdownBTN').attr('href', "http://admin:esp8266@" + $('#nodeDetailModalStatusIP' + id).text().trim() + "/shutdown");
      });

      socket.on('connect', function(){
        // We have connected over the socket, clear the page and request a full refresh
        socket.emit('syncRequest');
      });

      var md = new MobileDetect(window.navigator.userAgent);
      if(md.is('iPad') === true){
        // var chartHeight = $(window).height() - 1000;
        var chartHeight = 85;
      }
      else{
        var chartHeight = $(window).height() - 660;
      }
      console.info(chartHeight);

      socket.on('syncResponce', function(nodes){
        clearPage();

        for (var property in nodes) {
          if(nodes.hasOwnProperty(property)){
            console.info(nodes[property]);
            if(nodes[property].nodeID < 10) {
              nodes[property].nodeID = "0" + nodes[property].nodeID;
            }
            var li = $('#nodeButton' + nodes[property].nodeID);
            if (!li.length) {
              // Button doesn't exist, make button and modal
              var nodeButtonTemplate = Handlebars.compile ($("#nodeButtonTemplate").html());
              $('#nodeButtons').append(nodeButtonTemplate(nodes[property]));
              var nodeDetailModalTemplate = Handlebars.compile ($("#nodeDetailModalTemplate").html());
              $('#nodeModals').append(nodeDetailModalTemplate(nodes[property]));
              // $("#nodeDetailModalStatusVoltageChart" + nodes[property].nodeID).attr({height:chartHeight});
              chartData.current_voltage_data[nodes[property].nodeID] = nodes[property].current_voltage_data;
              chartData.lowest_voltage_data[nodes[property].nodeID] = nodes[property].lowest_voltage_data;

              // Attach click handler
              $("#nodeButtonEnabled" + nodes[property].nodeID).click(function() {
                if($(this).text() == " Disable"){
                  socket.emit('enabled', { nodeID : parseInt($(this).attr("id").replace(/\D/g,'')), enabled : false});
                }
                else{
                  socket.emit('enabled', { nodeID : parseInt($(this).attr("id").replace(/\D/g,'')), enabled : true});
                }
              });

              // Remove graph if created
              if(charts[nodes[property].nodeID] !== undefined){
                $("nodeDetailModalStatusVoltageChartPanel" + nodes[property].nodeID).empty().append('<canvas id="nodeDetailModalStatusVoltageChart' + nodes[property].nodeID + '"></canvas>');
                console.info($("#nodeDetailModalStatusVoltageChart" + nodes[property].nodeID));
                // $("#nodeDetailModalStatusVoltageChart" + nodes[property].nodeID).attr({height:chartHeight});
                charts[nodes[property].nodeID] = undefined;
              }

              // Trigger shown.bs.modal if on safari or ipad, show.bs.modal if not
              var trigger;
              if(md.is('iPad') || (!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/))){
                trigger = "shown.bs.modal";
              }
              else{
                trigger = "show.bs.modal";
              }

              $('#nodeDetailModal' + nodes[property].nodeID).on(trigger, function (event) {
                var button = $(event.relatedTarget); // Button that triggered the modal
                var id = button.data('nodeid'); // Extract info from data-* attributes

                // Generate graph if not created
                if(charts[id] === undefined){
                  var ctx = $("#nodeDetailModalStatusVoltageChart" + id);
                  window.charts[id] = new Chart(ctx, {
                    type: 'line',
                    data: {
                      labels: chartData.current_voltage_data[id],
                      datasets: [{
                        data: chartData.current_voltage_data[id],
                        fill: false,
                        pointRadius: 0,
                        borderWidth: 1,
                        borderColor: "rgba(255,0,0,0.6)"
                      },{
                        data: chartData.lowest_voltage_data[id],
                        fill: false,
                        pointRadius: 0,
                        borderColor: "rgba(0,0,255,0.3)"
                      }]
                    },
                    options: {
                      animation : false,
                      responsive: true,
                      legend: {
                        display: false,
                      },
                      hover: {
                        mode: 'single'
                      },
                      tooltips:{
                        enabled: false
                      },
                      scales: {
                        xAxes: [{
                          display: false,
                          scaleLabel: {
                            display: true,
                            labelString: 'Time'
                          }
                        }],
                        yAxes: [{
                          display: true,
                          scaleLabel: {
                            display: false,
                            labelString: 'Voltage'
                          },
                          ticks: {
                            max: 1000,
                            min: 675,
                            stepSize: 25
                          }
                        }]
                      }
                    }
                  });
                }
              });
            }
          }
        }
      });

      function clearPage(){
        $('.nodeDetailModal').modal('hide');
        $('.nodeButton').remove();
        //$('.nodeDetailModal').remove();
      }

      socket.on('beat', function(msg){
        var id = msg.mac.replace(/:/g, '-');
        console.info("Got a message with id '%s': %o", id, msg);

        if(msg.nodeID < 10){
          msg.nodeID = "0" + msg.nodeID;
        }

        var li = $('#nodeButton' + msg.nodeID);
        if (li.length) {
          // Button exists, update button and modal
          $('#nodeButtonConfigLink' + msg.nodeID).attr('href', 'http://admin:esp8266@' + msg.ip + '/').removeClass('disabled').parent().removeClass('disabled');
          $('#nodeButtonFindMeLink' + msg.nodeID).attr('href', 'http://admin:esp8266@' + msg.ip + '/findme').removeClass('disabled').parent().removeClass('disabled');
          $('#nodeButtonShutdownLink' + msg.nodeID).attr('data-address', 'http://admin:esp8266@' + msg.ip + '/shutdown').removeClass('disabled').parent().removeClass('disabled').attr('data-target', '#shutdownModal');
          $('#nodeButtonIcon' + msg.nodeID).css('color', '#' + msg.colour);
          if(msg.enabled === true){
            $('#nodeButtonMain' + msg.nodeID).removeClass('btn-danger').addClass('btn-success');
            $('#nodeButtonDropdown' + msg.nodeID).removeClass('btn-danger').addClass('btn-success');
          }
          else{
            $('#nodeButtonMain' + msg.nodeID).removeClass('btn-danger').addClass('btn-warning');
            $('#nodeButtonDropdown' + msg.nodeID).removeClass('btn-danger').addClass('btn-warning');
          }
        }

        var liModal = $('#nodeDetailModal' + msg.nodeID);
        if (!liModal.length){
          // Modal doesn't exist, make it
          var nodeDetailModalTemplate = Handlebars.compile ($("#nodeDetailModalTemplate").html());
          $('#nodeModals').append(nodeDetailModalTemplate(msg));
        }
        else {
          // Modal exists, update it
          $('#nodeDetailModalColour' + msg.nodeID).text("#" + msg.colour).removeClass("text-muted");
          $('#nodeDetailModalStatusIP' + msg.nodeID).text(msg.ip).attr("href", "http://" + msg.ip).removeClass("text-muted");
          $('#nodeDetailModalStatusMac' + msg.nodeID).text(msg.mac).removeClass("text-muted");
          $('#nodeDetailModalStatusCurrentVoltage' + msg.nodeID).text(msg.current_voltage).removeClass("text-muted");
          $('#nodeDetailModalStatusLowestVoltage' + msg.nodeID).text(msg.lowest_voltage).removeClass("text-muted");
          $('#nodeDetailModalStatusHardwareVersion' + msg.nodeID).text(msg.hw_version).removeClass("text-muted");
          $('#nodeDetailModalStatusSoftwareVersion' + msg.nodeID).text(msg.sw_version).removeClass("text-muted");
          var statusPrint;
          if(msg.online === true){
            statusPrint = "Online - ";
          }
          else{
            statusPrint = "Offline - ";
          }

          if(msg.enabled === true){
            statusPrint += "Enabled";
          }
          else{
            statusPrint += "Disabled";
          }
          $('#nodeDetailModalStatus' + msg.nodeID).text(statusPrint);
          if(charts[msg.nodeID] === undefined){
            // Chart doesn't exist, add it to buffer for when it is created
            chartData.current_voltage_data[msg.nodeID].push(msg.current_voltage);
            chartData.lowest_voltage_data[msg.nodeID].push(msg.lowest_voltage);
          }
          else{
            // Chart exists, add data directly to the cart and update
            charts[msg.nodeID].data.labels.push(msg.current_voltage);
            charts[msg.nodeID].data.datasets[0].data[charts[msg.nodeID].data.datasets[1].data.length] = msg.current_voltage;
            charts[msg.nodeID].data.datasets[1].data[charts[msg.nodeID].data.datasets[1].data.length] = msg.lowest_voltage;
            charts[msg.nodeID].update(0);
          }
        }
      });

      socket.on('online-status', function(msg){
        console.info(msg);
        if(msg.nodeID < 10){
          msg.nodeID = "0" + msg.nodeID;
        }
        if(msg.online === false){
          // Offline, find relevent settings and update them
          $('#nodeButtonMain' + msg.nodeID).addClass('btn-danger').removeClass('btn-success').removeClass('btn-warning');
          $('#nodeButtonDropdown' + msg.nodeID).addClass('btn-danger').removeClass('btn-success').removeClass('btn-warning');
          $('#nodeButtonConfigLink' + msg.nodeID).addClass('disabled').parent().addClass('disabled');
          $('#nodeButtonFindMeLink' + msg.nodeID).addClass('disabled').parent().addClass('disabled');
          $('#nodeButtonShutdownLink' + msg.nodeID).addClass('disabled').parent().addClass('disabled').attr('data-target', '');
          $('#nodeDetailModalStatus' + msg.nodeID).text($('#nodeDetailModalStatus' + msg.nodeID).text().replace("Online", "Offline"));
          $('#nodeDetailModalStatusIP' + msg.nodeID).addClass("text-muted");
          $('#nodeDetailModalStatusMac' + msg.nodeID).addClass("text-muted");
          $('#nodeDetailModalStatusCurrentVoltage' + msg.nodeID).addClass("text-muted");
          $('#nodeDetailModalStatusLowestVoltage' + msg.nodeID).addClass("text-muted");
          $('#nodeDetailModalStatusHardwareVersion' + msg.nodeID).addClass("text-muted");
          $('#nodeDetailModalStatusSoftwareVersion' + msg.nodeID).addClass("text-muted");
        }
      });

      socket.on('colours', function(msg){
        for(var i = 0; i < msg.nodes.length; i++){
          if(msg.nodes[i].nodeID < 10){
            msg.nodes[i].nodeID = "0" + msg.nodes[i].nodeID;
          }
          $('#nodeButtonIcon' + msg.nodes[i].nodeID).css('color', '#' + msg.nodes[i].colour);
          $('#nodeDetailModalColour' + msg.nodes[i].nodeID).text("#" + msg.nodes[i].colour);
        }
      });

      socket.on('enabled', function(msg){
        // Check there is an id and status
        if((msg.nodeID !== undefined) && (msg.enabled !== undefined)){
          if(msg.nodeID < 10){
            msg.nodeID = "0" + msg.nodeID;
          }
          if(msg.enabled === true){
            $("#nodeButtonEnabled" + msg.nodeID).html("<a href=\"#\"><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span> Disable</a>");
            if($('#nodeButtonMain' + msg.nodeID).hasClass('btn-warning')){
              // We were set to disabled, update button and modal
              $('#nodeButtonMain' + msg.nodeID).removeClass('btn-warning').addClass('btn-success');
              $('#nodeButtonDropdown' + msg.nodeID).removeClass('btn-warning').addClass('btn-success');
              $('#nodeDetailModalStatus' + msg.nodeID).text($('#nodeDetailModalStatus' + msg.nodeID).text().replace("Disabled", "Enabled"));
            }
          }
          else{
            $("#nodeButtonEnabled" + msg.nodeID).html("<a href=\"#\"><span class=\"glyphicon glyphicon-ok\" aria-hidden=\"true\"></span> Enable</a");
            if($('#nodeButtonMain' + msg.nodeID).hasClass('btn-success')){
              // We were set to disabled, update button and modal
              $('#nodeButtonMain' + msg.nodeID).removeClass('btn-success').addClass('btn-warning');
              $('#nodeButtonDropdown' + msg.nodeID).removeClass('btn-success').addClass('btn-warning');
              $('#nodeDetailModalStatus' + msg.nodeID).text($('#nodeDetailModalStatus' + msg.nodeID).text().replace("Enabled", "Disabled"));
            }
          }
        }
      });
    </script>
  </body>
  </html>